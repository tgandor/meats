{% extends "layout.html" %}
{% from "_pagination.html" import render_pagination %}

{% block title %}Duplicates - Diskindex{% endblock %}

{% block content %}
<h1>Duplicate Files</h1>

<div class="card">
    <form class="search-form" method="get" action="/duplicates">
        <label for="min_size">Minimum Size (KB):</label>
        <input type="number" name="min_size" id="min_size" placeholder="Min file size (KB)" value="{{ min_size // 1024 }}">
        <button type="submit" class="btn">Filter</button>
    </form>

    {% if pagination and pagination.total_count > 0 %}
    <div style="margin-top: 1rem;">
        <p><strong>Total wasted space:</strong> <span class="badge badge-danger">{{ total_wasted | filesizeformat }}</span></p>
        <p><strong>Duplicate groups found:</strong> {{ pagination.total_count }}</p>
    </div>
    {% endif %}
</div>

{% if duplicate_groups %}
    {% for group in duplicate_groups %}
    <div class="duplicate-group">
        <div class="duplicate-group-header">
            <div>
                <span class="badge badge-warning">{{ group.count }} copies</span>
                Size: {{ group.size | filesizeformat }} each
                Â· Wasted: <strong>{{ group.wasted_space | filesizeformat }}</strong>
            </div>
            <div>
                MD5: <code style="font-size: 0.85em;">{{ group.md5 }}</code>
            </div>
        </div>

        <ul class="file-list">
            {% for file in group.files %}
            <li>ðŸ“„ {{ file.path }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endfor %}

    {% if pagination %}
    {% set kwargs = {'min_size': min_size // 1024} %}
    {{ render_pagination(pagination, 'duplicates', **kwargs) }}
    {% endif %}
{% else %}
<div class="card">
    <p>No duplicates found{% if min_size > 1024 %} (minimum size: {{ min_size | filesizeformat }}){% endif %}.</p>
    <p>Try scanning more directories or reducing the minimum file size filter.</p>
</div>
{% endif %}
{% endblock %}
